EMU8086 GENERATED LISTING. MACHINE CODE <- SOURCE.
 
MUP DESIGN.com -- emu8086 assembler version: 4.08  
 
[ 19-04-2020  --  23:04:13 ] 
 
===================================================================================================
[LINE]     LOC: MACHINE CODE                          SOURCE
===================================================================================================
 
[   1]        :                                       .model tiny
[   2]        :                                       
[   3]    0202: 06 03                                 .data
[   4]        :                                       org	00
[   5]        :                                       
[   6]        :                                       ; keypad lookup table
[   7]    0102: 00 02 75                              keypad_table	db	060h,050h,030h
[   8]        :                                       keypad_table_length	equ	3
[   9]        :                                       
[  10]        :                                       ; port addresses of 8255
[  11]        :                                       porta equ 10h
[  12]        :                                       portb equ 12h
[  13]        :                                       portc equ 14h
[  14]        :                                       ctrl_addr equ 16h
[  15]        :                                       io_mode equ 80h
[  16]        :                                       
[  17]        :                                       ;delay and keyboard variables
[  18]    0105: 02                                    keypressed	db	?
[  19]        :                                       delay20mscount	equ	1000h
[  20]        :                                       
[  21]        :                                       ; key ids
[  22]        :                                       keyid_dairy_milk	equ 	1
[  23]        :                                       keyid_five_star		equ		2
[  24]        :                                       keyid_perk			equ		3
[  25]        :                                       
[  26]        :                                       
[  27]        :                                       ; stack
[  28]    0106: EB 07 80 3E 03 00 03 75 00 E8 09 01   stack1		dw	100 dup(0)
                E8 FA 02 E8 64 01 80 3E CC 00 00 74 
                D1 E8 CF 01 80 3E CC 00 00 75 08 E8 
                49 00 E8 74 00 EB BF 80 3E D2 00 04 
                7D 05 E8 E7 02 EB 03 E8 B3 02 EB AE 
                B8 00 4C CD 21 9C 50 53 51 52 B0 98 
                E6 16 B0 03 E6 12 B0 08 E6 14 5A 59 
                5B 58 9D C3 9C 50 53 51 52 B0 98 E6 
                16 B0 02 E6 12 B0 08 E6 14 5A 59 5B 
                58 9D C3 9C 50 53 51 52 B0 98 E6 16 
                B0 00 E6 12 B0 08 E6 14 5A 59 5B 58 
                9D C3 9C 50 53 51 52 B0 98 E6 16 B0 
                01 E6 12 B0 08 E6 14 5A 59 5B 58 9D 
                C3 9C 50 53 51 52 B9 00 10 90 90 90 
                90 90 E2 F9 5A 59 5B 58 9D C3 9C 50 
                53 51 52 B0 98 E6 16 B0 70 E6 14 E4 
                14 24 70 3C 70 75 F8 E8             
[  29]    01CE:                                       top_stack1	label	word
[  30]        :                                       
[  31]        :                                       ;pressure sensor variables
[  32]    01CE: D3                                    is_valid db ?
[  33]    01CF: FF                                    no_of_coins db ?
[  34]        :                                       pressure_offset equ 13
[  35]        :                                       pressure_limit equ 14
[  36]        :                                       pressure_limit_plus_offset equ 28   ;max coins=14,offset=13,+1(in-valid input from 15 coins onwards)
[  37]        :                                       
[  38]        :                                       ;state variables
[  39]    01D0: B0                                    state_porta db ?
[  40]    01D1: 70                                    state_portb db ?
[  41]    01D2: E6                                    state_portc db ?
[  42]    01D3: 14                                    state_control_register db ?
[  43]        :                                       
[  44]        :                                       ;validity condition variables
[  45]    01D4: E4                                    is_insufficient db 4 ; if set less than 4 then the chocolate id is insufficient
[  46]        :                                       coins_for_dairy_milk equ 4
[  47]        :                                       coins_for_five_star equ 2
[  48]        :                                       coins_for_perk equ 1
[  49]    01D5: 14                                    num_of_chocs db 0
[  50]    01D6: 24                                    num_of_dairy_milk_left db 30
[  51]    01D7: 70                                    num_of_five_star_left db 30
[  52]    01D8: 3C                                    num_of_perk_left db 30
[  53]        :                                       
[  54]        :                                       ;stepper motor rotation sequence variables
[  55]        :                                       stepper_motor_sequence1 equ 00000100b			;motor sequence with pb2=1
[  56]        :                                       stepper_motor_sequence2 equ 00001000b			;motor sequence with pb3=1
[  57]        :                                       stepper_motor_sequence3 equ 00010000b			;motor sequence with pb4=1
[  58]        :                                       stepper_motor_sequence4 equ 00100000b			;motor sequence with pb5=1
[  59]        :                                       
[  60]        :                                       
[  61]    01D9:                                       .code
[  62]    01D9:                                       .startup
[  63]        :                                       		; intialize ds, es,ss to start of ram
[  64]    01D9: 70 74 F8                              mov       ax,0200h
[  65]    01DC: E8 C4                                 mov       ds,ax
[  66]    01DE: FF B0                                 mov       es,ax
[  67]    01E0: 70 E6                                 mov       ss,ax
[  68]    01E2: 14 E4 14                              mov       sp,0fffeh
[  69]    01E5: 24 70 3C                              mov       si,0000
[  70]        :                                       		
[  71]        :                                       		
[  72]    01E8: 70 74                                 		mov al,00010111b
[  73]    01EA: E9 E8                                 		out 1eh,al             ;initialising 8253 to generate clock for adc
[  74]    01EC: B5 FF                                 		mov al,05h
[  75]    01EE: 3A 06                                 		out 18h,al
[  76]    01F0:                                       		main1:
[  77]        :                                       
[  78]        :                                       
[  79]    01F0: 00 00 75                              			call glow_nothing
[  80]        :                                       			
[  81]        :                                       			
[  82]        :                                       			;get the key pressed in the variable keypressed
[  83]    01F3: 07 C6 06                              			call get_key_pressed
[  84]        :                                       			
[  85]    01F6: 03 00 01 EB 1A                        			cmp keypressed,keyid_dairy_milk
[  86]    01FB: 3A 06                                 			jnz x1
[  87]    01FD: 01 00                                 			jmp x3
[  88]    01FF:                                       			x1:
[  89]    01FF: 75 07 C6 06 03                        				cmp keypressed,keyid_five_star
[  90]    0204: 00 02                                 				jnz x2
[  91]    0206: EB 0D                                 				jmp x3
[  92]    0208:                                       			x2:
[  93]    0208: 3A 06 02 00 75                        				cmp keypressed,keyid_perk
[  94]    020D: 07 C6                                 				jnz x3
[  95]        :                                       				
[  96]    020F:                                       			x3:
[  97]    020F: 06 03 00                              				call restore_ports
[  98]    0212: 03 EB 00                              				call glow_nothing
[  99]        :                                       			
[ 100]        :                                       			;start sensing pressure
[ 101]    0215: 5A 59 5B                              			call sense_input_pressure
[ 102]        :                                       			
[ 103]        :                                       			
[ 104]        :                                       			
[ 105]        :                                       			;check if the number of coins exceed or not
[ 106]    0218: 58 9D C3 9C 50                        				cmp is_valid,00h
[ 107]    021D: 53 51                                 				jz main1    ; if yes then discard and start fresh
[ 108]        :                                       				; else go to main2 where you see the key press.
[ 109]    021F:                                       		main2:
[ 110]        :                                       			;check for the validity as well as the multiplicity
[ 111]    021F: 52 B0 80                              			call validity_check_after_keypress
[ 112]        :                                       			
[ 113]        :                                       			;check if the number of coins is integral multiple or not
[ 114]    0222: E6 16 B0 00 E6                        				cmp is_valid,00h
[ 115]    0227: 10 B0                                 				jnz main3				; if yes then discard and start fresh
[ 116]    0229: 80 E6 16                              main1_before:	call glow_invalid
[ 117]    022C: B0 00 E6                              				call delay_20ms
[ 118]    022F: 12 B0                                 				jmp main1
[ 119]        :                                       				; else go to start motor to dispense the chocolates
[ 120]        :                                       			
[ 121]    0231:                                       		main3:
[ 122]        :                                       			;if the chocolates are not sufficient then go back
[ 123]    0231: 80 E6 16 B0 00                        				cmp is_insufficient,4
[ 124]    0236: E6 14                                 				jge main4
[ 125]    0238: 5A 59 5B                              				call glow_insufficient
[ 126]    023B: 58 9D                                 				jmp main_end
[ 127]        :                                       				
[ 128]    023D:                                       		main4:
[ 129]    023D: C3 9C 50                              				call start_motor
[ 130]        :                                       		
[ 131]    0240:                                       		main_end:
[ 132]    0240: 53 51                                 			    jmp main1
[ 133]        :                                       			
[ 134]    0242: 52 E4 16 A2 D1                        .exit
[ 135]    0247:                                       glow_five_star proc near
[ 136]    0247: 00                                    		pushf
[ 137]    0248: E4                                    		push	ax
[ 138]    0249: 10                                    		push	bx
[ 139]    024A: A2                                    		push	cx
[ 140]    024B: CE                                    		push	dx
[ 141]        :                                       
[ 142]        :                                       
[ 143]        :                                       	;set pb1 to 1 and pb0 to 1
[ 144]    024C: 00 E4                                 		mov al,10011000b
[ 145]    024E: 12 A2                                 		out ctrl_addr,al
[ 146]    0250: CF 00                                 		mov al, 00000011b
[ 147]    0252: E4 14                                 		out portb,al
[ 148]    0254: A2 D0                                 		mov al,00001000b
[ 149]    0256: 00 5A                                 		out portc,al
[ 150]        :                                       		
[ 151]    0258: 59                                    		pop	dx
[ 152]    0259: 5B                                    		pop	cx
[ 153]    025A: 58                                    		pop	bx
[ 154]    025B: 9D                                    		pop	ax
[ 155]    025C: C3                                    		popf
[ 156]        :                                       		
[ 157]    025D: 9C                                    		ret
[ 158]        :                                       
[ 159]        :                                       glow_five_star endp
[ 160]        :                                       
[ 161]    025E:                                       glow_dairy_milk proc near
[ 162]    025E: 50                                    		pushf
[ 163]    025F: 53                                    		push	ax
[ 164]    0260: 51                                    		push	bx
[ 165]    0261: 52                                    		push	cx
[ 166]    0262: A0                                    		push	dx
[ 167]        :                                       
[ 168]        :                                       
[ 169]        :                                       	;set pb1 to 1 and pb0 to 0
[ 170]    0263: D1 00                                 		mov al,10011000b
[ 171]    0265: E6 16                                 		out ctrl_addr,al
[ 172]    0267: A0 CE                                 		mov al, 00000010b
[ 173]    0269: 00 E6                                 		out portb,al
[ 174]    026B: 10 A0                                 		mov al,00001000b
[ 175]    026D: CF 00                                 		out portc,al
[ 176]        :                                       		
[ 177]    026F: E6                                    		pop	dx
[ 178]    0270: 12                                    		pop	cx
[ 179]    0271: A0                                    		pop	bx
[ 180]    0272: D0                                    		pop	ax
[ 181]    0273: 00                                    		popf
[ 182]        :                                       		
[ 183]    0274: E6                                    		ret
[ 184]        :                                       
[ 185]        :                                       glow_dairy_milk endp
[ 186]        :                                       
[ 187]    0275:                                       glow_invalid proc near
[ 188]    0275: 14                                    		pushf
[ 189]    0276: 5A                                    		push	ax
[ 190]    0277: 59                                    		push	bx
[ 191]    0278: 5B                                    		push	cx
[ 192]    0279: 58                                    		push	dx
[ 193]        :                                       	
[ 194]        :                                       	
[ 195]        :                                       	;set pb1 to 0 and pb0 to 0
[ 196]    027A: 9D C3                                 		mov al,10011000b
[ 197]    027C: 9C 50                                 		out ctrl_addr,al
[ 198]    027E: 53 51                                 		mov al, 00000000b
[ 199]    0280: 52 B0                                 		out portb,al
[ 200]    0282: 98 E6                                 		mov al,00001000b
[ 201]    0284: 16 B0                                 		out portc,al
[ 202]        :                                       		
[ 203]    0286: 00                                    		pop	dx
[ 204]    0287: E6                                    		pop	cx
[ 205]    0288: 14                                    		pop	bx
[ 206]    0289: E8                                    		pop	ax
[ 207]    028A: 17                                    		popf
[ 208]        :                                       		
[ 209]    028B: FF                                    		ret
[ 210]        :                                       
[ 211]        :                                       glow_invalid endp
[ 212]        :                                       
[ 213]    028C:                                       glow_perk proc near
[ 214]    028C: B0                                    		pushf
[ 215]    028D: 98                                    		push	ax
[ 216]    028E: E6                                    		push	bx
[ 217]    028F: 16                                    		push	cx
[ 218]    0290: B0                                    		push	dx
[ 219]        :                                       
[ 220]        :                                       	;set pb1 to 0 and pb0 to 1
[ 221]    0291: 02 E6                                 		mov al,10011000b
[ 222]    0293: 14 E8                                 		out ctrl_addr,al
[ 223]    0295: 0C FF                                 		mov al, 00000001b
[ 224]    0297: B0 98                                 		out portb,al
[ 225]    0299: E6 16                                 		mov al,00001000b
[ 226]    029B: B0 00                                 		out portc,al
[ 227]        :                                       
[ 228]    029D: E6                                    		pop	dx
[ 229]    029E: 12                                    		pop	cx
[ 230]    029F: B0                                    		pop	bx
[ 231]    02A0: 98                                    		pop	ax
[ 232]    02A1: E6                                    		popf
[ 233]        :                                       		
[ 234]    02A2: 16                                    		ret
[ 235]        :                                       
[ 236]        :                                       glow_perk endp
[ 237]        :                                       
[ 238]    02A3:                                       delay_20ms	proc	near
[ 239]    02A3: E4                                    		pushf
[ 240]    02A4: 14                                    		push	ax
[ 241]    02A5: 8A                                    		push	bx
[ 242]    02A6: D8                                    		push	cx
[ 243]    02A7: 80                                    		push	dx
[ 244]        :                                       		
[ 245]    02A8: E3 80 80                              		mov	cx, delay20mscount						; machine cycles count for 20ms
[ 246]    02AB: FB                                    x_delayloop:	nop
[ 247]    02AC: 00                                    		nop
[ 248]    02AD: 74                                    		nop
[ 249]    02AE: 02                                    		nop
[ 250]    02AF: EB                                    		nop
[ 251]    02B0: EE B0                                 		loop	x_delayloop
[ 252]        :                                       		
[ 253]    02B2: 98                                    		pop	dx
[ 254]    02B3: E6                                    		pop	cx
[ 255]    02B4: 16                                    		pop	bx
[ 256]    02B5: E4                                    		pop	ax
[ 257]    02B6: 10                                    		popf
[ 258]        :                                       		
[ 259]    02B7: B0                                    		ret
[ 260]        :                                       delay_20ms	endp
[ 261]        :                                       
[ 262]    02B8:                                       get_key_pressed proc near
[ 263]        :                                       		
[ 264]    02B8: 98                                    		pushf
[ 265]    02B9: E6                                    		push	ax
[ 266]    02BA: 16                                    		push	bx
[ 267]    02BB: E4                                    		push	cx
[ 268]    02BC: 10                                    		push	dx
[ 269]        :                                       		
[ 270]        :                                       		;setting 8255 pc lower(0-3) as output and pc upper(4-7) is input
[ 271]    02BD: 3C 1C                                 		mov al,10011000b
[ 272]    02BF: 7D 14                                 		out ctrl_addr,al
[ 273]        :                                       		;check for key release
[ 274]    02C1:                                       		xxx0:
[ 275]    02C1: 3C 00                                 				mov al,01110000b
[ 276]    02C3: 74 1C                                 				out portc,al
[ 277]        :                                       		; checking if all keys are released
[ 278]    02C5: C6 06                                 		xxx1:	in  al,portc
[ 279]    02C7: CC 00                                 				and al,70h
[ 280]    02C9: 01 8A                                 				cmp al,70h
[ 281]    02CB: D8 80                                 				jnz xxx1		
[ 282]    02CD: EB 0D 88                              				call delay_20ms
[ 283]        :                                       					
[ 284]    02D0: 1E CD                                 				mov al,01110000b
[ 285]    02D2: 00 EB                                 				out portc,al
[ 286]        :                                       		; checking for key pressed
[ 287]    02D4: 16 C6                                 		xxx2:		in al,portc
[ 288]    02D6: 06 CC                                 					and al,70h
[ 289]    02D8: 00 00                                 					cmp al,70h
[ 290]    02DA: C6 06                                 					jz xxx2		
[ 291]    02DC: CD 00 00                              					call delay_20ms
[ 292]        :                                       					; decoding key pressed
[ 293]    02DF: EB 0A                                 					mov al,01110000b
[ 294]    02E1: C6 06                                 					out portc,al
[ 295]    02E3: CC 00                                 					in al,portc
[ 296]    02E5: 00 C6                                 					and al,70h
[ 297]    02E7: 06 CD                                 					cmp al,70h		
[ 298]    02E9: 00 00                                 					jz xxx2
[ 299]    02EB: 5A 59 5B                              					call delay_20ms
[ 300]        :                                       		
[ 301]    02EE:                                       		xxx3:
[ 302]    02EE: 58 9D C3 9C                           					cmp al,keypad_table[0]
[ 303]    02F2: 50 53                                 					jnz xxx4
[ 304]    02F4: 51 52 80 3E 03                        					mov keypressed,keyid_dairy_milk
[ 305]    02F9: 00 01                                 					jmp get_key_pressed_end
[ 306]    02FB:                                       		xxx4:
[ 307]    02FB: 75 40 B1 04                           					cmp al,keypad_table[1]
[ 308]    02FF: A0 CD                                 					jnz xxx5
[ 309]    0301: 00 B5 00 A0 CD                        					mov keypressed,keyid_five_star
[ 310]    0306: 00 B4                                 					jmp get_key_pressed_end
[ 311]    0308:                                       		xxx5:
[ 312]    0308: 00 F6 F1 80                           					cmp al,keypad_table[2]
[ 313]    030C: FC 00                                 					jnz get_key_pressed_end
[ 314]    030E: 74 08 C6 06 CC                        					mov keypressed,keyid_perk
[ 315]    0313: 00 00                                 					jmp get_key_pressed_end
[ 316]    0315:                                       		get_key_pressed_end:
[ 317]    0315: E9                                    		pop	dx
[ 318]    0316: D5                                    		pop	cx
[ 319]    0317: 00                                    		pop	bx
[ 320]    0318: C6                                    		pop	ax
[ 321]    0319: 06                                    		popf
[ 322]    031A: CC                                    		ret
[ 323]        :                                       get_key_pressed endp
[ 324]        :                                       
[ 325]    031B:                                       restore_ports proc near
[ 326]        :                                       
[ 327]    031B: 00                                    		pushf
[ 328]    031C: 01                                    		push	ax
[ 329]    031D: A2                                    		push	bx
[ 330]    031E: D3                                    		push	cx
[ 331]    031F: 00                                    		push	dx
[ 332]        :                                       
[ 333]    0320: 28 06                                 		mov al,80h
[ 334]    0322: D4 00                                 		out ctrl_addr,al
[ 335]        :                                       		
[ 336]    0324: 80 3E                                 		mov al,00h
[ 337]    0326: D4 00                                 		out porta,al
[ 338]        :                                       		
[ 339]        :                                       		
[ 340]    0328: 00 7C                                 		mov al,80h
[ 341]    032A: 03 E9                                 		out ctrl_addr,al
[ 342]    032C: BF 00                                 		mov al,00000000b
[ 343]    032E: E8 2D                                 		out portb,al
[ 344]        :                                       		
[ 345]        :                                       		
[ 346]    0330: FE C6                                 		mov al,80h
[ 347]    0332: 06 D2                                 		out ctrl_addr,al
[ 348]    0334: 00 01                                 		mov al,00000000b
[ 349]    0336: 00 06                                 		out portc,al
[ 350]        :                                       		
[ 351]    0338: D4                                    		pop	dx
[ 352]    0339: 00                                    		pop	cx
[ 353]    033A: E9                                    		pop	bx
[ 354]    033B: B0                                    		pop	ax
[ 355]    033C: 00                                    		popf
[ 356]        :                                       		
[ 357]    033D: 80                                    		ret
[ 358]        :                                       restore_ports endp
[ 359]        :                                       
[ 360]        :                                       ;call this procedure before any procedure or inside any procedure that has a possibility of changing the state of ports.
[ 361]    033E:                                       store_state_of_ports proc near
[ 362]    033E: 3E                                    		pushf
[ 363]    033F: 03                                    		push	ax
[ 364]    0340: 00                                    		push	bx
[ 365]    0341: 02                                    		push	cx
[ 366]    0342: 75                                    		push	dx
[ 367]        :                                       
[ 368]    0343: 3F B1                                 		in al,ctrl_addr
[ 369]    0345: 02 A0 CD                              		mov state_control_register,al
[ 370]    0348: 00 A0                                 		in al,porta
[ 371]    034A: CD 00 B5                              		mov state_porta,al
[ 372]    034D: 00 A0                                 		in al,portb
[ 373]    034F: CD 00 B4                              		mov state_portb,al
[ 374]    0352: 00 F6                                 		in al,portc
[ 375]    0354: F1 80 FC                              		mov state_portc,al
[ 376]        :                                       
[ 377]    0357: 00                                    		pop	dx
[ 378]    0358: 74                                    		pop	cx
[ 379]    0359: 08                                    		pop	bx
[ 380]    035A: C6                                    		pop	ax
[ 381]    035B: 06                                    		popf
[ 382]        :                                       		
[ 383]    035C: CC                                    		ret	
[ 384]        :                                       store_state_of_ports endp
[ 385]        :                                       
[ 386]        :                                       ;call this procedure after any procedure that has a possibility of changing the state of ports.
[ 387]    035D:                                       revert_state_of_ports proc near
[ 388]    035D: 00                                    		pushf
[ 389]    035E: 00                                    		push	ax
[ 390]    035F: E9                                    		push	bx
[ 391]    0360: 8B                                    		push	cx
[ 392]    0361: 00                                    		push	dx
[ 393]        :                                       
[ 394]    0362: C6 06 CC                              		mov al,state_control_register
[ 395]    0365: 00 01                                 		out ctrl_addr,al
[ 396]    0367: A2 D3 00                              		mov al,state_porta
[ 397]    036A: 28 06                                 		out porta,al
[ 398]    036C: D5 00 80                              		mov al,state_portb
[ 399]    036F: 3E D5                                 		out portb,al
[ 400]    0371: 00 00 7D                              		mov al,state_portc
[ 401]    0374: 78 E8                                 		out portc,al
[ 402]        :                                       
[ 403]    0376: CF                                    		pop	dx
[ 404]    0377: FD                                    		pop	cx
[ 405]    0378: C6                                    		pop	bx
[ 406]    0379: 06                                    		pop	ax
[ 407]    037A: D2                                    		popf
[ 408]        :                                       		
[ 409]    037B: 00                                    		ret		
[ 410]        :                                       revert_state_of_ports endp
[ 411]        :                                       
[ 412]    037C:                                       sense_input_pressure proc near
[ 413]    037C: 02                                    			pushf
[ 414]    037D: 00                                    			push	ax
[ 415]    037E: 06                                    			push	bx
[ 416]    037F: D5                                    			push	cx
[ 417]    0380: 00                                    			push	dx
[ 418]        :                                       			
[ 419]        :                                       
[ 420]        :                                       			
[ 421]        :                                       						;send start of conversion signal to adc along with address of analog input channel to activate
[ 422]    0381: EB 6A                                 								mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 423]    0383: C6 06                                 								out ctrl_addr,al
[ 424]        :                                       								;making it low to high
[ 425]        :                                       								
[ 426]    0385: CC 00                                 								mov al,00000000b		;setting pc1(soc) to 0,pc0 to 0
[ 427]    0387: 00 80                                 								out portc,al
[ 428]    0389: 3E 03 00                              								call delay_20ms
[ 429]        :                                       								
[ 430]    038C: 03 75                                 								mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 431]    038E: 5E B1                                 								out ctrl_addr,al
[ 432]    0390: 01 A0                                 								mov al,00000010b		;setting pc1(soc) to 1,pc0 to 0
[ 433]    0392: CD 00                                 								out portc,al
[ 434]        :                                       								
[ 435]    0394: A0 CD 00                              								call delay_20ms
[ 436]        :                                       								
[ 437]    0397: B5 00                                 								mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 438]    0399: A0 CD                                 								out ctrl_addr,al
[ 439]    039B: 00 B4                                 								mov al,00h				;setting pb6,pb7 to 0,0
[ 440]    039D: 00 F6                                 								out portb,al
[ 441]        :                                       						;giving conversion time to adc
[ 442]        :                                       						;right now giving a longer delay(20ms) rather than only conversion time of adc(100us)
[ 443]        :                                       						;check for end of conversion signal from adc
[ 444]        :                                       								
[ 445]        :                                       								
[ 446]    039F:                                       eoc_check:						
[ 447]    039F: F1 80                                 								mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 448]    03A1: FC 00                                 								out ctrl_addr,al
[ 449]    03A3: 74 07                                 								in al,portc
[ 450]    03A5: C6 06                                 								mov bl,al
[ 451]    03A7: CC 00 00                              								and bl,10000000b
[ 452]    03AA: EB 41 C6                              								cmp bl,00h
[ 453]    03AD: 06 CC                                 								jz eoc_done
[ 454]    03AF: 00 01                                 								jmp eoc_check
[ 455]        :                                       								
[ 456]        :                                       						;conversion complete move to taking input from adc
[ 457]    03B1: A2 D3                                 eoc_done:						mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 458]    03B3: 00 28                                 								out ctrl_addr,al
[ 459]    03B5: 06 D6                                 								in al,porta				;taking d0-d7 from adc into porta and then into al for further processing.
[ 460]        :                                       						
[ 461]        :                                       						;to check validity of input by examining d0-d7 sequence
[ 462]    03B7: 00 80                                 						mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 463]    03B9: 3E D6                                 						out ctrl_addr,al
[ 464]    03BB: 00 00                                 						in al,porta				;taking d0-d7 from adc into porta and then into al for further processing.
[ 465]        :                                       
[ 466]        :                                       						
[ 467]    03BD: 7D 2E                                 						cmp al,pressure_limit_plus_offset
[ 468]    03BF: E8 CA                                 						jge pressure_limit_exceed
[ 469]    03C1: FD C6                                 						cmp al,00h
[ 470]    03C3: 06 D2                                 						je pressure_limit_fall_short
[ 471]    03C5: 00 03 00 06 D6                        						mov is_valid,01h
[ 472]    03CA: 00 EB                                 						mov bl,al
[ 473]    03CC: 20 C6 06                              						sub bl,pressure_offset
[ 474]    03CF: CC 00 01 B5                           						mov no_of_coins,bl
[ 475]    03D3: 00 A0                                 						jmp pressure_finish
[ 476]    03D5: CD 00 B4 00 F6                        pressure_limit_exceed:	mov is_valid,00h
[ 477]    03DA: F1 80 FC 00 74                        						mov no_of_coins,00h
[ 478]    03DF: 05 C6                                 						jmp pressure_finish
[ 479]    03E1: 06 CC 00 00 C6                        pressure_limit_fall_short: mov is_valid,00h
[ 480]    03E6: 06 CC 00 01 A2                        						mov no_of_coins,00h
[ 481]    03EB:                                       pressure_finish:
[ 482]        :                                       	
[ 483]    03EB: D3                                    		pop	dx
[ 484]    03EC: 00                                    		pop	cx
[ 485]    03ED: 5A                                    		pop	bx
[ 486]    03EE: 59                                    		pop	ax
[ 487]    03EF: 5B                                    		popf
[ 488]        :                                       		
[ 489]    03F0: 58                                    		ret		
[ 490]        :                                       sense_input_pressure endp
[ 491]        :                                       
[ 492]    03F1:                                       validity_check_after_keypress proc near
[ 493]    03F1: 9D                                    		pushf
[ 494]    03F2: C3                                    		push	ax
[ 495]    03F3: 9C                                    		push	bx
[ 496]    03F4: 50                                    		push	cx
[ 497]    03F5: 53                                    		push	dx
[ 498]        :                                       		
[ 499]        :                                       		; get number of coins for the key pressed
[ 500]    03F6:                                       		dairy_milk_pressed:
[ 501]    03F6: 51 52 8A 0E D3                        			cmp keypressed,keyid_dairy_milk
[ 502]    03FB: 00 B5                                 			jnz five_star_pressed
[ 503]    03FD: 00 E8                                 			mov cl,coins_for_dairy_milk
[ 504]    03FF: 5C 00 E8                              			mov al,no_of_coins
[ 505]    0402: 9F FD                                 			mov ch,00h
[ 506]    0404: E8 A6 00                              		    mov al,no_of_coins
[ 507]    0407: E2 F5                                 		    mov ah,00h
[ 508]        :                                       		
[ 509]        :                                       		     ;check if the number of coins is the integral multiple of the key pressed
[ 510]    0409: 5A 59                                 	      	div cl             ; al = ax/cl, ah = remainder
[ 511]        :                                       		
[ 512]        :                                       		;compare the remainder
[ 513]    040B: 5B 58 9D                              		    cmp ah,00h
[ 514]    040E: C3 9C                                 			jz set_it_valid1
[ 515]    0410: 50 53 51 52 B0                        			mov is_valid,00h
[ 516]    0415: 80 E6 16                              			jmp validity_end
[ 517]        :                                       			
[ 518]    0418:                                       			set_it_valid1:
[ 519]    0418: B0 00 E6 14 5A                        			mov is_valid,01h
[ 520]    041D: 59 5B 58                              			mov num_of_chocs,al
[ 521]    0420: 9D C3 9C 50                           			sub num_of_dairy_milk_left,al
[ 522]    0424: 53 51 52 E8 E5                        			cmp num_of_dairy_milk_left,00h
[ 523]    0429: FF 80 3E D2 00                        			jge	validity_end
[ 524]    042E: 01 75 05                              			call glow_dairy_milk
[ 525]    0431: E8 2A FD EB 18                        			mov is_insufficient,keyid_dairy_milk
[ 526]    0436: 80 3E D2 00                           			add num_of_dairy_milk_left,al
[ 527]    043A: 02 75 05                              			jmp validity_end
[ 528]        :                                       			
[ 529]        :                                       		
[ 530]    043D:                                       		five_star_pressed:
[ 531]    043D: E8 07 FD EB 0C                        			cmp keypressed,keyid_five_star
[ 532]    0442: 80 3E                                 			jnz perk_pressed
[ 533]    0444: D2 00                                 			mov cl,coins_for_five_star
[ 534]    0446: 03 75 05                              			mov al,no_of_coins
[ 535]    0449: E8 40 FD                              			mov al,no_of_coins
[ 536]    044C: EB 00                                 			mov ch,00h
[ 537]    044E: E8 52 FD                              		    mov al,no_of_coins
[ 538]    0451: E8 4F                                 		    mov ah,00h
[ 539]        :                                       		
[ 540]        :                                       		     ;check if the number of coins is the integral multiple of the key pressed
[ 541]    0453: FD E8                                 	      	div cl             ; al = ax/cl, ah = remainder
[ 542]        :                                       		
[ 543]        :                                       		;compare the remainder
[ 544]    0455: B8 FF 5A                              		    cmp ah,00h
[ 545]    0458: 59 5B                                 			jz set_it_valid2
[ 546]    045A: 58 9D C3 9C 50                        			mov is_valid,00h
[ 547]    045F: 53 51 52                              			jmp validity_end
[ 548]        :                                       			
[ 549]    0462:                                       			set_it_valid2:
[ 550]    0462: B0 98 E6 16 E4                        			mov is_valid,01h
[ 551]    0467: 14 8A D0                              			mov num_of_chocs,al
[ 552]    046A: 8A DA 80 E3                           			sub num_of_five_star_left,al
[ 553]    046E: F7 8A C3 E6 14                        			cmp num_of_five_star_left,00h
[ 554]    0473: B0 98                                 			jge	validity_end
[ 555]    0475: E6 16 B0                              			call glow_five_star
[ 556]    0478: 04 E6 12 E8 25                        			mov is_insufficient,keyid_five_star
[ 557]    047D: FD B0 98 E6                           			add num_of_five_star_left,al
[ 558]    0481: 16 B0                                 			jmp validity_end
[ 559]        :                                       		
[ 560]    0483:                                       		perk_pressed:
[ 561]    0483: 08 E6 12 E8 1A                        			mov is_valid,00h
[ 562]    0488: FD B0 98 E6 16                        			cmp keypressed,keyid_perk
[ 563]    048D: B0 10                                 			jnz validity_end
[ 564]    048F: E6 12                                 			mov cl,coins_for_perk
[ 565]    0491: E8 0F FD                              			mov al,no_of_coins
[ 566]    0494: B0 98 E6                              			mov al,no_of_coins
[ 567]    0497: 16 B0                                 			mov ch,00h
[ 568]    0499: 20 E6 12                              		    mov al,no_of_coins
[ 569]    049C: E8 04                                 		    mov ah,00h
[ 570]        :                                       		
[ 571]        :                                       		     ;check if the number of coins is the integral multiple of the key pressed
[ 572]    049E: FD B0                                 	      	div cl             ; al = ax/cl, ah = remainder
[ 573]        :                                       		
[ 574]        :                                       		;compare the remainder
[ 575]    04A0: 98 E6 16                              		    cmp ah,00h
[ 576]    04A3: 8A C2                                 			jz set_it_valid3
[ 577]    04A5: E6 14 5A 59 5B                        			mov is_valid,00h
[ 578]    04AA: 58 9D                                 			jmp validity_end
[ 579]    04AC:                                       			set_it_valid3:
[ 580]    04AC: C3 9C 50 53 51                        			mov is_valid,01h
[ 581]    04B1: 52 B0 98                              			mov num_of_chocs,al
[ 582]    04B4: E6 16 E4 14                           			sub num_of_perk_left,al
[ 583]    04B8: 8A D0 8A DA 80                        			cmp num_of_perk_left,00h
[ 584]    04BD: E3 F7                                 			jge	validity_end
[ 585]    04BF: 8A C3 E6                              			call glow_perk
[ 586]    04C2: 14 B0 98 E6 16                        			mov is_insufficient,keyid_perk
[ 587]    04C7: B0 10 E6 12                           			add num_of_perk_left,al
[ 588]    04CB: E8 D5                                 			jmp validity_end
[ 589]    04CD:                                       		after_chocolate_selected:
[ 590]    04CD: FC B0 98 E6 16                        			mov is_valid,01h
[ 591]        :                                       		
[ 592]    04D2: B0 04                                 		mov ch,00h
[ 593]    04D4: E6 12 E8                              		mov al,no_of_coins
[ 594]    04D7: CA FC                                 		mov ah,00h
[ 595]        :                                       		
[ 596]        :                                       		;check if the number of coins is the integral multiple of the key pressed
[ 597]    04D9: B0 98                                 		div cl             ; al = ax/cl, ah = remainder
[ 598]        :                                       		
[ 599]        :                                       		;compare the remainder
[ 600]    04DB: E6 16 B0                              		cmp ah,00h
[ 601]    04DE: 20 E6                                 		jz set_it_valid
[ 602]    04E0: 12 E8 BF FC B0                        		mov is_valid,00h
[ 603]        :                                       		
[ 604]    04E5:                                       		set_it_valid:
[ 605]    04E5: 98 E6 16 B0 10                        		mov is_valid,01h
[ 606]    04EA: E6 12 E8                              		mov num_of_chocs,al
[ 607]    04ED:                                       		validity_end:
[ 608]        :                                       		
[ 609]    04ED: B4                                    		pop	dx
[ 610]    04EE: FC                                    		pop	cx
[ 611]    04EF: B0                                    		pop	bx
[ 612]    04F0: 98                                    		pop	ax
[ 613]    04F1: E6                                    		popf
[ 614]        :                                       		
[ 615]    04F2: 16                                    		ret		
[ 616]        :                                       
[ 617]        :                                       validity_check_after_keypress endp
[ 618]        :                                       
[ 619]    04F3:                                       start_motor proc near
[ 620]        :                                       		
[ 621]    04F3: 8A                                    		pushf
[ 622]    04F4: C2                                    		push	ax
[ 623]    04F5: E6                                    		push	bx
[ 624]    04F6: 14                                    		push	cx
[ 625]    04F7: 5A                                    		push	dx
[ 626]        :                                       		
[ 627]        :                                       		; now dummy glow led the number of time the chocolates are ordedairy_milk
[ 628]    04F8: 59 5B 58 9D                           		mov cl,num_of_chocs
[ 629]    04FC: C3 58                                 		mov ch,00h
[ 630]        :                                       		
[ 631]    04FE:                                       		start_motor1:
[ 632]    04FE: 9D C3 E6                              			call stepper_motor_open
[ 633]    0501: 16 8A C2                              			call delay_20ms
[ 634]    0504: E6 14 5A                              			call stepper_motor_close
[ 635]    0507: 59 5B                                 			loop start_motor1
[ 636]        :                                       
[ 637]    0509:                                       motorend:
[ 638]        :                                       			
[ 639]        :                                       
[ 640]    0509: 58                                    		pop	dx
[ 641]    050A: 9D                                    		pop	cx
[ 642]    050B: C3                                    		pop	bx
[ 643]    050C: 00                                    		pop	ax
[ 644]    050D: 00                                    		popf
[ 645]        :                                       		
[ 646]    050E: 00                                    		ret		
[ 647]        :                                       start_motor endp
[ 648]        :                                       
[ 649]    050F:                                       glow_nothing proc near
[ 650]        :                                       		
[ 651]    050F: 00                                    		pushf
[ 652]    0510: 00                                    		push	ax
[ 653]    0511: 00                                    		push	bx
[ 654]    0512: 00                                    		push	cx
[ 655]    0513: 00                                    		push	dx
[ 656]        :                                       		
[ 657]    0514: 00 00                                 		mov al,80h
[ 658]    0516: 00 00                                 		out ctrl_addr,al
[ 659]    0518: 00 00                                 		mov al,00000000b
[ 660]    051A: 00 00                                 		out portc,al
[ 661]        :                                       		
[ 662]    051C: 00                                    		pop	dx
[ 663]    051D: 00                                    		pop	cx
[ 664]    051E: 00                                    		pop	bx
[ 665]    051F: 00                                    		pop	ax
[ 666]    0520: 00                                    		popf
[ 667]        :                                       		
[ 668]    0521: 00                                    		ret		
[ 669]        :                                       
[ 670]        :                                       glow_nothing endp
[ 671]        :                                       
[ 672]    0522:                                       glow_insufficient proc near
[ 673]        :                                       
[ 674]    0522: 00                                    		pushf
[ 675]    0523: 00                                    		push	ax
[ 676]    0524: 00                                    		push	bx
[ 677]    0525: 00                                    		push	cx
[ 678]    0526: 00                                    		push	dx
[ 679]        :                                       		
[ 680]    0527: 00 00 00                              		call glow_nothing
[ 681]        :                                       		
[ 682]    052A: 00 00 00 00 00                        		cmp is_insufficient,keyid_dairy_milk
[ 683]    052F: 00 00                                 		jnz glow_insufficient1
[ 684]    0531: 00 00 00                              		call glow_dairy_milk
[ 685]    0534: 00 00                                 		jmp glow_insufficient_end
[ 686]        :                                       		
[ 687]    0536:                                       		glow_insufficient1:
[ 688]    0536: 00 00 00 00 00                        		cmp is_insufficient,keyid_five_star
[ 689]    053B: 00 00                                 		jnz glow_insufficient2
[ 690]    053D: 00 00 00                              		call glow_five_star
[ 691]    0540: 00 00                                 		jmp glow_insufficient_end
[ 692]        :                                       		
[ 693]    0542:                                       		glow_insufficient2:
[ 694]    0542: 00 00 00 00 00                        		cmp is_insufficient,keyid_perk
[ 695]    0547: 00 00                                 		jnz glow_insufficient_end
[ 696]    0549: 00 00 00                              		call glow_perk
[ 697]    054C: 00 00                                 		jmp glow_insufficient_end
[ 698]        :                                       		
[ 699]    054E:                                       		glow_insufficient_end:
[ 700]    054E: 00 00 00                              		call delay_20ms
[ 701]    0551: 00 00 00                              		call delay_20ms
[ 702]    0554: 00 00 00                              		call glow_nothing
[ 703]        :                                       		
[ 704]    0557: 00                                    		pop	dx
[ 705]    0558: 00                                    		pop	cx
[ 706]    0559: 00                                    		pop	bx
[ 707]    055A: 00                                    		pop	ax
[ 708]    055B: 00                                    		popf
[ 709]        :                                       		
[ 710]    055C: 00                                    		ret	
[ 711]        :                                       glow_insufficient endp
[ 712]        :                                       
[ 713]    055D:                                       stepper_motor_open proc near
[ 714]        :                                       ;give the sequence to stepper motor such that at a time one input is 1,others are 0.
[ 715]        :                                       ;clockwise rotation is taken as opening of motor slot.
[ 716]        :                                       
[ 717]    055D: 00                                    		pushf
[ 718]    055E: 00                                    		push	ax
[ 719]    055F: 00                                    		push	bx
[ 720]    0560: 00                                    		push	cx
[ 721]    0561: 00                                    		push	dx
[ 722]        :                                       
[ 723]    0562: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 724]    0564: 00 00                                 		out ctrl_addr,al
[ 725]        :                                       		;to disable the decoder putting pc3=0
[ 726]    0566: 00 00                                 		in al,portc
[ 727]    0568: 00 00                                 		mov dl,al
[ 728]    056A: 00 00                                 		mov bl,dl
[ 729]    056C: 00 00 00                              		and bl,11110111b
[ 730]    056F: 00 00                                 		mov al,bl
[ 731]    0571: 00 00                                 		out portc,al
[ 732]    0573: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 733]    0575: 00 00                                 		out ctrl_addr,al
[ 734]    0577: 00 00                                 		mov al,stepper_motor_sequence1
[ 735]    0579: 00 00                                 		out portb,al
[ 736]    057B: 00 00 00                              		call delay_20ms
[ 737]        :                                       		
[ 738]    057E: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 739]    0580: 00 00                                 		out ctrl_addr,al
[ 740]    0582: 00 00                                 		mov al,stepper_motor_sequence2
[ 741]    0584: 00 00                                 		out portb,al
[ 742]    0586: 00 00 00                              		call delay_20ms
[ 743]    0589: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 744]    058B: 00 00                                 		out ctrl_addr,al
[ 745]    058D: 00 00                                 		mov al,stepper_motor_sequence3
[ 746]    058F: 00 00                                 		out portb,al
[ 747]    0591: 00 00 00                              		call delay_20ms
[ 748]    0594: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 749]    0596: 00 00                                 		out ctrl_addr,al
[ 750]    0598: 00 00                                 		mov al,stepper_motor_sequence4
[ 751]    059A: 00 00                                 		out portb,al
[ 752]    059C: 00 00 00                              		call delay_20ms
[ 753]    059F: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 754]    05A1: 00 00                                 		out ctrl_addr,al
[ 755]    05A3: 00 00                                 		mov al,dl
[ 756]    05A5: 00 00                                 		out portc,al
[ 757]        :                                       		
[ 758]    05A7: 00                                    		pop	dx
[ 759]    05A8: 00                                    		pop	cx
[ 760]    05A9: 00                                    		pop	bx
[ 761]    05AA: 00                                    		pop	ax
[ 762]    05AB: 00                                    		popf
[ 763]        :                                       		
[ 764]    05AC: 00                                    		ret
[ 765]        :                                       
[ 766]        :                                       stepper_motor_open endp
[ 767]        :                                       
[ 768]    05AD:                                       stepper_motor_close proc near
[ 769]        :                                       ;give the sequence to stepper motor such that at a time one input is 1,others are 0.
[ 770]        :                                       ;anti-clockwise rotation is taken as closing of motor slot.
[ 771]        :                                       
[ 772]    05AD: 00                                    		pushf
[ 773]    05AE: 00                                    		push	ax
[ 774]    05AF: 00                                    		push	bx
[ 775]    05B0: 00                                    		push	cx
[ 776]    05B1: 00                                    		push	dx
[ 777]        :                                       
[ 778]    05B2: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 779]    05B4: 00 00                                 		out ctrl_addr,al
[ 780]        :                                       		;to disable the decoder putting pc3=0
[ 781]    05B6: 00 00                                 		in al,portc
[ 782]    05B8: 00 00                                 		mov dl,al
[ 783]    05BA: 00 00                                 		mov bl,dl
[ 784]    05BC: 00 00 00                              		and bl,11110111b
[ 785]    05BF: 00 00                                 		mov al,bl
[ 786]    05C1: 00 00                                 		out portc,al
[ 787]    05C3: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 788]    05C5: 00 00                                 		out ctrl_addr,al
[ 789]    05C7: 00 00                                 		mov al,stepper_motor_sequence3
[ 790]    05C9: 00 00                                 		out portb,al
[ 791]    05CB: 00 00 00                              		call delay_20ms
[ 792]    05CE: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 793]    05D0: 00 00                                 		out ctrl_addr,al
[ 794]    05D2: 00 00                                 		mov al,stepper_motor_sequence1
[ 795]    05D4: 00 00                                 		out portb,al
[ 796]    05D6: 00 00 00                              		call delay_20ms
[ 797]    05D9: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 798]    05DB: 00 00                                 		out ctrl_addr,al
[ 799]    05DD: 00 00                                 		mov al,stepper_motor_sequence4
[ 800]    05DF: 00 00                                 		out portb,al
[ 801]    05E1: 00 00 00                              		call delay_20ms
[ 802]    05E4: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 803]    05E6: 00 00                                 		out ctrl_addr,al
[ 804]    05E8: 00 00                                 		mov al,stepper_motor_sequence3
[ 805]    05EA: 00 00                                 		out portb,al
[ 806]    05EC: 00 00 00                              		call delay_20ms
[ 807]        :                                       		
[ 808]        :                                       		;restore state of portc
[ 809]    05EF: 00 00                                 		mov al,10011000b  		;setting portc upper(4-7) as input and portc lower(0-3) as output,porta as input,portb as output
[ 810]    05F1: 00 00                                 		out ctrl_addr,al
[ 811]    05F3: 00 00                                 		mov al,dl
[ 812]    05F5: 00 00                                 		out portc,al
[ 813]        :                                       		
[ 814]    05F7: 00                                    		pop	dx
[ 815]    05F8: 00                                    		pop	cx
[ 816]    05F9: 00                                    		pop	bx
[ 817]    05FA: 00                                    		pop	ax
[ 818]    05FB: 00                                    		popf
[ 819]        :                                       		
[ 820]    05FC: 00                                    		ret
[ 821]        :                                       
[ 822]        :                                       stepper_motor_close endp
[ 823]        :                                       
[ 824]        :                                       end
[ 825]        :                                       
 
===================================================================================================
 




===================================================================================================
